<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ğŸ” ã‚µã‚¦ãƒ³ãƒ‰å¹²æ¸‰ãƒ‡ãƒãƒƒã‚°</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #222; color: white; }
        button { padding: 15px 30px; margin: 5px; border: none; border-radius: 5px; background: #4CAF50; color: white; cursor: pointer; }
        .log { background: #333; padding: 10px; margin: 10px 0; border-radius: 4px; max-height: 300px; overflow-y: auto; }
        .error { background: #d32f2f; }
        .success { background: #2e7d32; }
    </style>
</head>
<body>
    <h1>ğŸ” ã‚µã‚¦ãƒ³ãƒ‰å¹²æ¸‰ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</h1>
    
    <div>
        <button onclick="testBasicSound()">ğŸµ åŸºæœ¬éŸ³ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testAfterGameLoad()">ğŸ® ã‚²ãƒ¼ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆå¾Œãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testSoundManager()">ğŸ”§ soundManagerãƒ†ã‚¹ãƒˆ</button>
        <button onclick="clearLog()">ğŸ§¹ ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>
    
    <div id="log" class="log"></div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // åŸºæœ¬çš„ãªéŸ³ãƒ†ã‚¹ãƒˆ
        async function testBasicSound() {
            log('ğŸµ åŸºæœ¬éŸ³ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                log(`âœ… AudioContextä½œæˆæˆåŠŸ (çŠ¶æ…‹: ${audioContext.state})`);
                
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                    log(`âœ… AudioContextå†é–‹å®Œäº† (çŠ¶æ…‹: ${audioContext.state})`);
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.3);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
                
                log('âœ… åŸºæœ¬éŸ³å†ç”Ÿå®Œäº†', 'success');
                
            } catch (error) {
                log(`âŒ åŸºæœ¬éŸ³ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // ã‚²ãƒ¼ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ã‹ã‚‰ãƒ†ã‚¹ãƒˆ
        async function testAfterGameLoad() {
            log('ğŸ® ã‚²ãƒ¼ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å¾Œãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            try {
                // sound.jsã‚’å‹•çš„èª­ã¿è¾¼ã¿
                if (!window.SoundManager) {
                    const soundScript = document.createElement('script');
                    soundScript.src = 'sound.js';
                    document.head.appendChild(soundScript);
                    
                    await new Promise((resolve, reject) => {
                        soundScript.onload = resolve;
                        soundScript.onerror = reject;
                    });
                }
                
                log('âœ… sound.jsèª­ã¿è¾¼ã¿å®Œäº†');
                
                // soundManagerã®ç¢ºèª
                if (window.soundManager) {
                    log(`âœ… window.soundManagerå­˜åœ¨ç¢ºèª`);
                    log(`ğŸ“Š soundManagerçŠ¶æ…‹: enabled=${window.soundManager.isEnabled}, context=${!!window.soundManager.audioContext}`);
                    
                    if (window.soundManager.audioContext) {
                        log(`ğŸ“Š AudioContextçŠ¶æ…‹: ${window.soundManager.audioContext.state}`);
                    }
                    
                    // soundManagerã§éŸ³å†ç”Ÿãƒ†ã‚¹ãƒˆ
                    log('ğŸµ soundManagerã§éŸ³å†ç”Ÿãƒ†ã‚¹ãƒˆ...');
                    window.soundManager.playAttackSound();
                    log('âœ… soundManageréŸ³å†ç”Ÿå®Ÿè¡Œ', 'success');
                    
                } else {
                    log('âŒ window.soundManagerãŒå­˜åœ¨ã—ã¾ã›ã‚“', 'error');
                }
                
            } catch (error) {
                log(`âŒ ã‚²ãƒ¼ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆå¾Œãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // soundManagerã®è©³ç´°ãƒ†ã‚¹ãƒˆ
        async function testSoundManager() {
            log('ğŸ”§ soundManagerã®è©³ç´°ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            if (!window.soundManager) {
                log('âŒ soundManagerãŒå­˜åœ¨ã—ã¾ã›ã‚“', 'error');
                return;
            }
            
            const sm = window.soundManager;
            log(`ğŸ“Š isEnabled: ${sm.isEnabled}`);
            log(`ğŸ“Š audioContext: ${!!sm.audioContext}`);
            log(`ğŸ“Š debugMode: ${sm.debugMode}`);
            
            if (sm.audioContext) {
                log(`ğŸ“Š AudioContext.state: ${sm.audioContext.state}`);
                log(`ğŸ“Š AudioContext.sampleRate: ${sm.audioContext.sampleRate}`);
                
                // è¤‡æ•°ã®AudioContextã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯
                const audioContexts = [];
                if (window.AudioContext) audioContexts.push('AudioContext');
                if (window.webkitAudioContext) audioContexts.push('webkitAudioContext');
                log(`ğŸ“Š åˆ©ç”¨å¯èƒ½ãªAudioContext: ${audioContexts.join(', ')}`);
                
                // ç›´æ¥createToneã‚’å‘¼ã³å‡ºã—ã¦ã¿ã‚‹
                try {
                    log('ğŸµ soundManager.createToneç›´æ¥å‘¼ã³å‡ºã—...');
                    sm.createTone(523, 0.3, 'sine', 0.3); // C5éŸ³
                    log('âœ… createToneå®Ÿè¡ŒæˆåŠŸ', 'success');
                } catch (error) {
                    log(`âŒ createToneå¤±æ•—: ${error.message}`, 'error');
                }
            }
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('click', () => {
            log('ğŸ‘† ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ¤œçŸ¥ - éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†');
        }, { once: true });
        
        log('ğŸ” ãƒ‡ãƒãƒƒã‚°ãƒšãƒ¼ã‚¸æº–å‚™å®Œäº† - ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆé–‹å§‹');
    </script>
</body>
</html>